import{d as P,r as w,C as j,o as q,c as L,s as A,b as x,j as y,_ as K,D as Q,E as G,a as U,G as W,H as X,f as e,w as t,k as m,F as I,A as Y,B,t as E,g as T,u as Z,I as ee,J as N,L as z,i as n,v as te,M as oe}from"./index-3760782f.js";import{s as M}from"./request-c9b17271.js";import{f as ae}from"./filter-10201db7.js";const le={class:"panel-content"},se=P({__name:"panel",setup(g,{expose:h}){const p=w();return j(()=>{}),q(()=>{}),h({handleEdit:()=>{const l=p.value.querySelector(".panel-content");l.style.maxHeight="600px"},handleSave:()=>{const l=p.value.querySelector(".panel-content");l.style.maxHeight=l.scrollHeight+"px"},handleCollapse:()=>{const l=p.value.querySelector(".panel-content");l.classList.toggle("panel-active"),l.style.maxHeight?l.style.maxHeight=null:l.style.maxHeight=l.scrollHeight+"px"}}),(l,u)=>(y(),L("span",{ref_key:"panel",ref:p,class:"fish-panel"},[A(l.$slots,"header",{},void 0,!0),x("div",le,[A(l.$slots,"content",{},void 0,!0)])],512))}});const J=K(se,[["__scopeId","data-v-d964caa4"]]),H={getReportList:g=>M({url:"/report/list",method:"get",params:g}),updateReport:g=>M({url:"/report/update",method:"post",data:g}),deleteReport:g=>M({url:"/report/delete",method:"post",data:g})},O=Q("report",{state:()=>({reportList:[],totalCounts:0}),getters:{},actions:{updateReportList(g){return new Promise((h,p)=>{H.getReportList(g).then(r=>{if(r.data.resultCode==="01"){const{reportList:v,pageInfo:o}=r.data.resultData;this.reportList=v||[],this.totalCounts=o.totalCounts||0,h({reportList:this.reportList,totalCounts:this.totalCounts})}else p()}).catch(r=>{p(r)})})}}}),ne={class:"px-4 mx-4 font-bold text-gray-500"},re={class:"w-full text-left"},ce={key:0,class:"py-4 text-black"},ie={key:1,class:"py-4"},de={class:"text-right"},pe=P({__name:"report-content",emits:["updateReportList"],setup(g,{expose:h,emit:p}){const r=w(!1),v=a=>ae.parseTime(parseInt(a),"{y}-{m}-{d}"),o=w(),l=O(),u=G(()=>l.reportList),D=U({});j(()=>{}),q(()=>{}),W(()=>{});const S=a=>{a&&ee.confirm("此操作将永久删除该记录, 是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H.deleteReport({reportId:a}).then(_=>{_.data.resultCode==="01"?(p("updateReportList"),N({type:"success",message:"删除成功"})):N({type:"error",message:"删除失败"})})})},V=(a,_)=>{o.value[_].handleEdit(),a.isEdit=!a.isEdit,a.editContent=a.content},C=(a,_)=>{if(a.editContent){const i=Object.assign({reportId:0},a);i.reportId=i.id,i.content=i.editContent||"",i.date=v(i.date||""),H.updateReport(i).then(s=>{r.value=!1,s.data.resultCode==="01"?(z({title:"记录成功",message:"",type:"success"}),o.value[_].handleSave(),a.isEdit=!a.isEdit,p("updateReportList")):z({title:"记录失败",message:"",type:"error"})}).catch(s=>{r.value=!1,z({title:"记录失败",message:s,type:"error"})})}},c=a=>{console.log(a,o.value),o.value[a].handleCollapse()};return h({...X(D)}),(a,_)=>{const i=n("el-checkbox"),s=n("el-col"),k=n("el-row"),R=n("el-button"),$=n("el-input");return y(),L(I,null,[x("div",ne,[e(k,{gutter:10},{default:t(()=>[e(s,{span:2},{default:t(()=>[e(i)]),_:1}),e(s,{span:7},{default:t(()=>[m(" 时间(星期)")]),_:1}),e(s,{span:10,class:"overflow-hidden text-ellipsis whitespace-nowrap"},{default:t(()=>[m(" 内容")]),_:1}),e(s,{span:5,class:"text-right"},{default:t(()=>[m(" 操作 ")]),_:1})]),_:1})]),(y(!0),L(I,null,Y(Z(u),(d,f)=>(y(),B(J,{key:f,index:f,ref_for:!0,ref_key:"PanelRef",ref:o,class:"bg-white p-4 m-4 hover:shadow-xl shadow rounded text-gray-600 block"},{header:t(()=>[x("button",re,[e(k,{gutter:10,onClick:b=>c(f)},{default:t(()=>[e(s,{span:2},{default:t(()=>[e(i)]),_:1}),e(s,{span:7},{default:t(()=>[m(E(v(d.date||""))+"("+E(d.week)+")",1)]),_:2},1024),e(s,{span:10,class:"overflow-hidden text-ellipsis whitespace-nowrap"},{default:t(()=>[m(E(d.content),1)]),_:2},1024),e(s,{span:5,class:"text-right"},{default:t(()=>[e(R,{type:"danger",text:"",bg:"",onClick:T(b=>S(d.id),["stop"])},{default:t(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])])]),content:t(()=>[d.isEdit?(y(),L("div",ie,[e($,{modelValue:d.editContent,"onUpdate:modelValue":b=>d.editContent=b,type:"textarea",rows:4},null,8,["modelValue","onUpdate:modelValue"])])):(y(),L("div",ce,E(d.content),1)),x("div",de,[d.isEdit?(y(),B(R,{key:1,type:"success",text:"",bg:"",onClick:b=>C(d,f),loading:r.value},{default:t(()=>[m(" 保存 ")]),_:2},1032,["onClick","loading"])):(y(),B(R,{key:0,type:"primary",onClick:T(b=>V(d,f),["stop"])},{default:t(()=>[m(" 修改 ")]),_:2},1032,["onClick"]))])]),_:2},1032,["index"]))),128))],64)}}}),ue=P({__name:"report-add-dialog",emits:["updateReportList"],setup(g,{expose:h,emit:p}){const r=w(),v=U({date:[{required:!0,message:"请选择日期",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]}),o=U({date:new Date,content:"",id:"",week:""}),l=w(!1),u=w(!1),D=()=>{l.value=!0},S=async C=>{u.value||await C.validate(c=>{if(c){u.value=!0;var a=new Array("日","一","二","三","四","五","六");o.week=a[new Date(o.date).getDay()],H.updateReport(o).then(_=>{u.value=!1,_.data.resultCode==="01"?(z({title:"修改成功",message:"",type:"success"}),p("updateReportList"),l.value=!1,V(C)):z({title:"修改失败",message:"",type:"error"})}).catch(_=>{u.value=!1,z({title:"修改失败",message:_,type:"error"})})}else return!1})},V=C=>{C.resetFields()};return h({open:D}),(C,c)=>{const a=n("el-date-picker"),_=n("el-form-item"),i=n("el-input"),s=n("el-button"),k=n("el-col"),R=n("el-row"),$=n("el-form"),d=n("el-dialog");return y(),B(d,{title:"提示",modelValue:l.value,"onUpdate:modelValue":c[4]||(c[4]=f=>l.value=f),width:"340px"},{default:t(()=>[e($,{ref_key:"ruleFormRef",ref:r,model:o,rules:v},{default:t(()=>[e(_,{label:"记录日期",prop:"date"},{default:t(()=>[e(a,{type:"date",placeholder:"选择日期",modelValue:o.date,"onUpdate:modelValue":c[0]||(c[0]=f=>o.date=f)},null,8,["modelValue"])]),_:1}),e(_,{label:"内容",prop:"content"},{default:t(()=>[e(i,{type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:"请输入内容",modelValue:o.content,"onUpdate:modelValue":c[1]||(c[1]=f=>o.content=f)},null,8,["modelValue"])]),_:1}),e(R,{gutter:10,class:"mt-12"},{default:t(()=>[e(k,{span:12},{default:t(()=>[e(s,{type:"info",class:"w-full",onClick:c[2]||(c[2]=f=>V(r.value)),loading:u.value},{default:t(()=>[m("重置")]),_:1},8,["loading"])]),_:1}),e(k,{span:12},{default:t(()=>[e(s,{type:"primary",class:"w-full",onClick:c[3]||(c[3]=f=>S(r.value)),loading:u.value},{default:t(()=>[m("提交")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),_e={class:"flex flex-col h-full bg-gray-200 overflow-x-hidden overflow-y-auto"},fe={class:"w-full flex-0 p-2 text-right"},ge={class:"sm:block flex flex-row items-center my-2"},me=x("span",{class:"px-2 text-white"},"→",-1),he={class:"flex-auto overflow-auto"},ve={class:"p-4 sm:m-auto text-center flex-0 overflow-auto h-20"},we=P({__name:"report",setup(g){const h=w(null),p=O(),r=w(!1),v=w(),o=U({startDate:"",endDate:"",page:1,pageSize:10,totalCounts:G(()=>p.totalCounts)}),l=()=>{o.page=1,u()},u=async()=>{r.value||(r.value=!0,await p.updateReportList(o).catch(()=>{r.value=!1}),r.value=!1)},D=()=>{h.value.open()},S=c=>{o.pageSize=c,l()},V=c=>{o.page=c,u()},C=()=>{v.value.handleCollapse()};return q(()=>{l()}),(c,a)=>{const _=n("CirclePlus"),i=n("el-icon"),s=n("el-button"),k=n("Delete"),R=n("RefreshRight"),$=n("Search"),d=n("el-date-picker"),f=n("el-pagination"),b=oe("loading");return te((y(),L("div",_e,[x("div",fe,[e(s,{text:"",size:"large",circle:"",onClick:D},{default:t(()=>[e(i,{size:"30"},{default:t(()=>[e(_)]),_:1})]),_:1}),e(s,{text:"",size:"large",circle:""},{default:t(()=>[e(i,{size:"30"},{default:t(()=>[e(k)]),_:1})]),_:1}),e(s,{text:"",size:"large",circle:"",onClick:u},{default:t(()=>[e(i,{size:"30"},{default:t(()=>[e(R)]),_:1})]),_:1}),e(J,{ref_key:"PanelRef",ref:v},{header:t(()=>[e(s,{text:"",size:"large",circle:"",onClick:C,class:"ml-3"},{default:t(()=>[e(i,{size:"30"},{default:t(()=>[e($)]),_:1})]),_:1})]),content:t(()=>[x("div",ge,[e(d,{class:"w-auto mb-2",type:"date",align:"right",modelValue:o.startDate,"onUpdate:modelValue":a[0]||(a[0]=F=>o.startDate=F)},null,8,["modelValue"]),me,e(d,{class:"w-auto mb-2",type:"date",align:"right",modelValue:o.endDate,"onUpdate:modelValue":a[1]||(a[1]=F=>o.endDate=F)},null,8,["modelValue"]),e(s,{type:"primary",class:"-mt-2 ml-2",onClick:l},{default:t(()=>[m("确定")]),_:1})])]),_:1},512)]),x("div",he,[e(pe,{onUpdateReportList:u})]),x("div",ve,[e(f,{class:"h-full",background:"",layout:" prev, pager, next,sizes,total, jumper",total:o.totalCounts,"current-page":o.page,"page-size":o.pageSize,"page-sizes":[10,30,50,100],onSizeChange:S,onCurrentChange:V},null,8,["total","current-page","page-size"])]),e(ue,{ref_key:"ReportAddDialogRef",ref:h,onUpdateReportList:u},null,512)])),[[b,r.value]])}}});export{we as default};
